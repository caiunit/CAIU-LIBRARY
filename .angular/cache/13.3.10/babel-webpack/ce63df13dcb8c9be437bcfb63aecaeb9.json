{"ast":null,"code":"import _get from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\get.js\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\getPrototypeOf.js\";\nimport _inherits from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\inherits.js\";\nimport _createSuper from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createSuper.js\";\nimport _classCallCheck from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\classCallCheck.js\";\nimport _createClass from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createClass.js\";\nimport { Store } from '@ngrx/store';\nimport { filter, take } from 'rxjs/operators';\nimport { getValue, truthy } from './utils';\nimport { MessagesActions } from '../events/events.actions';\nimport { HttpActions } from '../http/http.actions';\nimport { actionsStreamSelector } from './actions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nexport var DumbComponent = /*#__PURE__*/(function () {\n  var DumbComponent = /*#__PURE__*/function () {\n    function DumbComponent() {\n      _classCallCheck(this, DumbComponent);\n\n      this.requestState = 'DEFAULT';\n      this.subscriptions = [];\n    }\n\n    _createClass(DumbComponent, [{\n      key: \"inErrorState\",\n      get: function get() {\n        return this.requestState === 'ERROR';\n      }\n    }, {\n      key: \"inSuccessState\",\n      get: function get() {\n        return this.requestState === 'SUCCESS';\n      }\n    }, {\n      key: \"message\",\n      get: function get() {\n        return this.inErrorState ? \"An error has occurred. Please try again later.\" : this.inSuccessState ? \"Saved successfully!\" : '';\n      }\n    }, {\n      key: \"showMessage\",\n      get: function get() {\n        return this.inErrorState || this.inSuccessState;\n      }\n    }, {\n      key: \"ngOnDestroy\",\n      value: function ngOnDestroy() {\n        this.removeSubscriptions();\n      }\n    }, {\n      key: \"addSubscription\",\n      value: function addSubscription(subscription) {\n        this.subscriptions.push(subscription);\n      }\n    }, {\n      key: \"closeDialog\",\n      value: function closeDialog(result) {\n        this.dialogSubscription.unsubscribe();\n      }\n    }, {\n      key: \"openDialog\",\n      value: function openDialog(component) {\n        var _this = this;\n\n        var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        var dialogRef = this.dialog.open(component, config);\n        this.dialogSubscription = dialogRef.afterClosed().subscribe(function (result) {\n          _this.closeDialog(result);\n        });\n      }\n    }, {\n      key: \"playAudioElement\",\n      value: function playAudioElement(tag) {\n        var el = document.getElementById(tag);\n\n        if (el && typeof el['play'] === 'function') {\n          el['play']();\n        }\n      }\n    }, {\n      key: \"playAudioFile\",\n      value: function playAudioFile(file) {\n        var audio = new Audio(file);\n        audio.play();\n      }\n    }, {\n      key: \"print\",\n      value: function print(html) {\n        var iframe = document.createElement('iframe');\n\n        iframe.onload = function () {\n          var doc = iframe.contentDocument ? iframe.contentDocument : iframe.contentWindow.document;\n          doc.getElementsByTagName('body')[0].innerHTML = html;\n          iframe.contentWindow.focus(); // This is key, the iframe must have focus first\n\n          iframe.contentWindow.print();\n        };\n\n        document.getElementsByTagName('body')[0].appendChild(iframe);\n      }\n    }, {\n      key: \"removeSubscriptions\",\n      value: function removeSubscriptions() {\n        this.subscriptions.forEach(function (s) {\n          s.unsubscribe();\n        });\n      }\n    }, {\n      key: \"subscribe\",\n      value: function subscribe(subscriptions) {\n        var _this2 = this;\n\n        subscriptions.forEach(function (s) {\n          _this2.addSubscription(s);\n        });\n      }\n    }, {\n      key: \"sync\",\n      value: function sync(keys) {\n        var _this3 = this;\n\n        keys.forEach(function (key) {\n          var subscription = _this3[\"\".concat(key, \"$\")].subscribe(function (e) {\n            _this3[key] = e;\n          });\n\n          _this3.addSubscription(subscription);\n        });\n      }\n    }, {\n      key: \"syncKey\",\n      value: function syncKey(key, handler) {\n        var _this4 = this;\n\n        var subscription = this[\"\".concat(key, \"$\")].subscribe(function (e) {\n          _this4[key] = e;\n\n          if (handler && typeof handler === 'function') {\n            handler(e);\n          }\n        });\n        this.addSubscription(subscription);\n      }\n    }, {\n      key: \"flashErrorMessage\",\n      value: function flashErrorMessage() {\n        var _this5 = this;\n\n        var duration = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5000;\n        this.toErrorState();\n        setTimeout(function () {\n          _this5.resetRequestState();\n        }, duration);\n      }\n    }, {\n      key: \"flashSuccessMessage\",\n      value: function flashSuccessMessage() {\n        var _this6 = this;\n\n        var duration = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5000;\n        this.toSucessState();\n        setTimeout(function () {\n          _this6.resetRequestState();\n        }, duration);\n      }\n    }, {\n      key: \"onError\",\n      value: function onError(e) {\n        this.flashErrorMessage();\n      }\n    }, {\n      key: \"onSuccess\",\n      value: function onSuccess(e) {\n        this.flashSuccessMessage();\n      }\n    }, {\n      key: \"resetRequestState\",\n      value: function resetRequestState() {\n        this.requestState = 'DEFAULT';\n      }\n    }, {\n      key: \"setValue\",\n      value: function setValue(value) {\n        if (this.form && this.form.setValue) {\n          this.form.setValue(getValue(value));\n        }\n      }\n    }, {\n      key: \"toErrorState\",\n      value: function toErrorState() {\n        this.requestState = 'ERROR';\n      }\n    }, {\n      key: \"toSucessState\",\n      value: function toSucessState() {\n        this.requestState = 'SUCCESS';\n      }\n    }]);\n\n    return DumbComponent;\n  }();\n\n  DumbComponent.ɵfac = function DumbComponent_Factory(t) {\n    return new (t || DumbComponent)();\n  };\n\n  DumbComponent.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n    type: DumbComponent\n  });\n  return DumbComponent;\n})();\nexport var FormComponent = /*#__PURE__*/(function () {\n  var FormComponent = /*#__PURE__*/function (_DumbComponent) {\n    _inherits(FormComponent, _DumbComponent);\n\n    var _super = _createSuper(FormComponent);\n\n    function FormComponent() {\n      _classCallCheck(this, FormComponent);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(FormComponent, [{\n      key: \"editing\",\n      get: function get() {\n        return truthy(this.id);\n      }\n    }, {\n      key: \"id\",\n      get: function get() {\n        return this.model.id;\n      }\n    }, {\n      key: \"isValid\",\n      get: function get() {\n        return this.form.valid;\n      }\n    }, {\n      key: \"getControl\",\n      value: function getControl(key) {\n        return this.form.controls[key];\n      }\n    }, {\n      key: \"getControlValue\",\n      value: function getControlValue(key, defaultValue) {\n        return this.form.value[key] || defaultValue;\n      }\n    }, {\n      key: \"getControlValueChanges\",\n      value: function getControlValueChanges(key, fn) {\n        var control = this.getControl(key);\n        return control.valueChanges.subscribe(fn);\n      }\n    }, {\n      key: \"getValue\",\n      value: function getValue() {\n        var defaultValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n        return this.form.value || defaultValue;\n      }\n    }, {\n      key: \"getValueChanges\",\n      value: function getValueChanges(fn) {\n        return this.form.valueChanges.subscribe(fn);\n      }\n    }, {\n      key: \"markAsSubmitted\",\n      value: function markAsSubmitted() {\n        var _this7 = this;\n\n        this.form.markAsTouched();\n        Object.keys(this.form.controls).forEach(function (key) {\n          _this7.form.controls[key].markAsTouched();\n        });\n      }\n    }, {\n      key: \"setControlValue\",\n      value: function setControlValue(key, value) {\n        var control = this.getControl(key);\n        control.setValue(value);\n      }\n    }, {\n      key: \"subscribeToChanges\",\n      value: function subscribeToChanges(key, fn) {\n        this.addSubscription(this.getValueChanges(fn));\n      }\n    }, {\n      key: \"subscribeToControlChanges\",\n      value: function subscribeToControlChanges(key, fn) {\n        this.addSubscription(this.getControlValueChanges(key, fn));\n      }\n    }]);\n\n    return FormComponent;\n  }(DumbComponent);\n\n  FormComponent.ɵfac = /*@__PURE__*/function () {\n    var ɵFormComponent_BaseFactory;\n    return function FormComponent_Factory(t) {\n      return (ɵFormComponent_BaseFactory || (ɵFormComponent_BaseFactory = i0.ɵɵgetInheritedFactory(FormComponent)))(t || FormComponent);\n    };\n  }();\n\n  FormComponent.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n    type: FormComponent,\n    features: [i0.ɵɵInheritDefinitionFeature]\n  });\n  return FormComponent;\n})();\nexport var SmartComponent = /*#__PURE__*/(function () {\n  var SmartComponent = /*#__PURE__*/function (_DumbComponent2) {\n    _inherits(SmartComponent, _DumbComponent2);\n\n    var _super2 = _createSuper(SmartComponent);\n\n    function SmartComponent(store) {\n      var _this8;\n\n      _classCallCheck(this, SmartComponent);\n\n      _this8 = _super2.call(this);\n      _this8.store = store;\n      _this8.messages = [];\n      _this8.channels = [];\n      _this8.actions$ = actionsStreamSelector(store);\n      return _this8;\n    }\n\n    _createClass(SmartComponent, [{\n      key: \"hasMessages\",\n      get: function get() {\n        return this.messages && Array.isArray(this.messages) && this.messages.length > 0;\n      }\n    }, {\n      key: \"onInit\",\n      value: function onInit() {\n        if (this.hasMessages) {\n          this.dispatch(MessagesActions.subscribe(this.messages));\n        }\n      }\n    }, {\n      key: \"ngOnDestroy\",\n      value: function ngOnDestroy() {\n        if (this.hasMessages) {\n          this.dispatch(MessagesActions.unsubscribe(this.messages));\n        }\n\n        this.removeChannels();\n\n        _get(_getPrototypeOf(SmartComponent.prototype), \"ngOnDestroy\", this).call(this);\n      }\n    }, {\n      key: \"addChannel\",\n      value: function addChannel(channel, action) {\n        if (this.hubService && typeof this.hubService.addEffect == 'function' && this.channels.findIndex(function (x) {\n          return x === channel;\n        }) === -1) {\n          this.hubService.addEffect(channel, action);\n          this.channels.push(channel);\n        }\n      }\n    }, {\n      key: \"dispatch\",\n      value: function dispatch(action) {\n        this.store.dispatch(action);\n      }\n    }, {\n      key: \"dispatchAndSubscribe\",\n      value: function dispatchAndSubscribe(action, onSuccess, onError) {\n        var _this9 = this;\n\n        var f1 = onSuccess ? onSuccess : function (e) {\n          _this9.flashSuccessMessage();\n        };\n        var f2 = onError ? onError : function (e) {\n          _this9.flashErrorMessage();\n        };\n\n        if (this.events && this.events.dispatch) {\n          this.addSubscription(this.events.dispatch(action).subscribe(f1, f2));\n        } else {\n          this.store.dispatch(action);\n        }\n      }\n    }, {\n      key: \"httpDelete\",\n      value: function httpDelete(path, payload, onSuccess, onError) {\n        this.dispatch(HttpActions.delete(path, payload, onSuccess, onError));\n        return this.actions$.pipe(filter(function (x) {\n          return x && (x.type === onSuccess || x.type === onError);\n        }), take(1));\n      }\n    }, {\n      key: \"httpGet\",\n      value: function httpGet(path, onSuccess, onError) {\n        this.dispatch(HttpActions.get(path, onSuccess, onError));\n        return this.actions$.pipe(filter(function (x) {\n          return x && (x.type === onSuccess || x.type === onError);\n        }), take(1));\n      }\n    }, {\n      key: \"httpPost\",\n      value: function httpPost(path, payload, onSuccess, onError) {\n        this.dispatch(HttpActions.post(path, payload, onSuccess, onError));\n        return this.actions$.pipe(filter(function (x) {\n          return x && (x.type === onSuccess || x.type === onError);\n        }), take(1));\n      }\n    }, {\n      key: \"httpPut\",\n      value: function httpPut(path, payload, onSuccess, onError) {\n        this.dispatch(HttpActions.put(path, payload, onSuccess, onError));\n        return this.actions$.pipe(filter(function (x) {\n          return x && (x.type === onSuccess || x.type === onError);\n        }), take(1));\n      }\n    }, {\n      key: \"removeChannel\",\n      value: function removeChannel(channel) {\n        if (this.hubService && typeof this.hubService.removeEffect == 'function') {\n          this.hubService.removeEffect(channel);\n        }\n      }\n    }, {\n      key: \"removeChannels\",\n      value: function removeChannels() {\n        var _this10 = this;\n\n        if (this.hubService && typeof this.hubService.removeEffect == 'function') {\n          this.channels.forEach(function (x) {\n            _this10.hubService.removeEffect(x);\n          });\n        }\n      }\n    }]);\n\n    return SmartComponent;\n  }(DumbComponent);\n\n  SmartComponent.ɵfac = function SmartComponent_Factory(t) {\n    return new (t || SmartComponent)(i0.ɵɵdirectiveInject(i1.Store));\n  };\n\n  SmartComponent.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n    type: SmartComponent,\n    features: [i0.ɵɵInheritDefinitionFeature]\n  });\n  return SmartComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}