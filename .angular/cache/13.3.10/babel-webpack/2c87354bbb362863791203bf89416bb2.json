{"ast":null,"code":"import _toConsumableArray from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";\nimport _classCallCheck from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\classCallCheck.js\";\nimport _createClass from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createClass.js\";\nimport _inherits from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\inherits.js\";\nimport _createSuper from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createSuper.js\";\nimport { EventEmitter, ElementRef, QueryList } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Store } from '@ngrx/store';\nimport { Widget } from '../widgets.model';\nimport { WidgetsActions, widgetsLookupSelector, userWidgetsSelector, widgetsDefaultSelector, widgetsHeightSelector, hasDefaultWidgetsSelector } from '../widgets.reducer';\nimport { ConfirmDeleteComponent } from '../../components/dialog/confirm-delete/confirm-delete.component';\nimport { HttpActions } from '../../http/http.actions';\nimport { routeNameSelector } from '../../router/selectors';\nimport { SmartComponent } from '../../shared/component';\nimport { build } from '../../shared/utils';\nimport { windowHeightSelector, windowWidthSelector } from '../../store/selectors';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/icon\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nvar _c0 = [\"btnWidget\"];\n\nfunction WidgetsMenuComponent_div_0_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      var ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.restoreDefault();\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"settings_backup_restore\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Reset \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_mat_spinner_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"mat-spinner\", 9);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵproperty(\"diameter\", 30);\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r9);\n      var ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.back();\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"navigate_before\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_button_7_mat_icon_2_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mat-icon\", 15);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_7_mat_icon_2_Template_mat_icon_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      var w_r10 = i0.ɵɵnextContext().$implicit;\n      var ctx_r14 = i0.ɵɵnextContext(2);\n      return ctx_r14.deleteWidget(w_r10.id, w_r10.active);\n    });\n    i0.ɵɵtext(1, \"add_circle\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_button_7_mat_icon_3_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mat-icon\", 16);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_7_mat_icon_3_Template_mat_icon_click_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      var w_r10 = i0.ɵɵnextContext().$implicit;\n      var ctx_r17 = i0.ɵɵnextContext(2);\n      return ctx_r17.deleteWidget(w_r10.id, w_r10.active);\n    });\n    i0.ɵɵtext(1, \"cancel\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r21 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 11, 12);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_7_Template_button_click_0_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r21);\n      var w_r10 = restoredCtx.$implicit;\n      var ctx_r20 = i0.ɵɵnextContext(2);\n      return ctx_r20.onAdd(w_r10.name);\n    });\n    i0.ɵɵtemplate(2, WidgetsMenuComponent_div_0_button_7_mat_icon_2_Template, 2, 0, \"mat-icon\", 13);\n    i0.ɵɵtemplate(3, WidgetsMenuComponent_div_0_button_7_mat_icon_3_Template, 2, 0, \"mat-icon\", 14);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var w_r10 = ctx.$implicit;\n    i0.ɵɵproperty(\"disabled\", w_r10.id !== 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !w_r10.active);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", w_r10.active);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", w_r10.label, \" \");\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_button_8_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r23 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function WidgetsMenuComponent_div_0_button_8_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r23);\n      var ctx_r22 = i0.ɵɵnextContext(2);\n      return ctx_r22.next();\n    });\n    i0.ɵɵelementStart(1, \"mat-icon\");\n    i0.ɵɵtext(2, \"navigate_next\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction WidgetsMenuComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 1);\n    i0.ɵɵtemplate(1, WidgetsMenuComponent_div_0_button_1_Template, 4, 0, \"button\", 2);\n    i0.ɵɵtemplate(2, WidgetsMenuComponent_div_0_mat_spinner_2_Template, 1, 1, \"mat-spinner\", 3);\n    i0.ɵɵelementStart(3, \"span\", 4);\n    i0.ɵɵtext(4, \"Add Widgets to Dashboard:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, WidgetsMenuComponent_div_0_button_5_Template, 3, 0, \"button\", 5);\n    i0.ɵɵelementStart(6, \"div\", 6);\n    i0.ɵɵtemplate(7, WidgetsMenuComponent_div_0_button_7_Template, 5, 4, \"button\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, WidgetsMenuComponent_div_0_button_8_Template, 3, 0, \"button\", 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.restoringDefaults);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.restoringDefaults);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showBack);\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleProp(\"width\", ctx_r0.hostWidth, \"px\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.visibleItems);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showNext);\n  }\n}\n\nexport var WidgetsMenuComponent = /*#__PURE__*/(function () {\n  var WidgetsMenuComponent = /*#__PURE__*/function (_SmartComponent) {\n    _inherits(WidgetsMenuComponent, _SmartComponent);\n\n    var _super = _createSuper(WidgetsMenuComponent);\n\n    function WidgetsMenuComponent(store, el, dialog) {\n      var _this;\n\n      _classCallCheck(this, WidgetsMenuComponent);\n\n      _this = _super.call(this, store);\n      _this.store = store;\n      _this.el = el;\n      _this.dialog = dialog;\n      _this.increment = 3;\n      _this.width = 300;\n      _this.wrapperHeight = 0;\n      _this.add = new EventEmitter();\n      _this.remove = new EventEmitter();\n      _this.defaultWidgets = [];\n      _this.hasDefaultWidgets = true;\n      _this._index = 0;\n      _this.lkpWidgets = [];\n      _this.restoringDefaults = false;\n      _this._userId = 0;\n      _this.visibleItems = [];\n      _this._widgets = [];\n      _this.widgetsHeight = 0;\n      _this.windowHeight = 0;\n      _this.windowWidth = 0;\n      _this._elWidth = 0;\n      _this._visible = false;\n      _this.defaultWidgets$ = widgetsDefaultSelector(store);\n      _this.hasDefaultWidgets$ = hasDefaultWidgetsSelector(store);\n      _this.lkpWidgets$ = widgetsLookupSelector(store);\n      _this.routeName$ = routeNameSelector(store);\n      _this.widgets$ = userWidgetsSelector(store);\n      _this.widgetsHeight$ = widgetsHeightSelector(store);\n      _this.windowHeight$ = windowHeightSelector(store);\n      _this.windowWidth$ = windowWidthSelector(store);\n      return _this;\n    }\n\n    _createClass(WidgetsMenuComponent, [{\n      key: \"visible\",\n      get: function get() {\n        return this._visible;\n      },\n      set: function set(value) {\n        this._visible = value;\n      }\n    }, {\n      key: \"userId\",\n      get: function get() {\n        return this._userId;\n      },\n      set: function set(value) {\n        this._userId = value;\n      }\n    }, {\n      key: \"hostWidth\",\n      get: function get() {\n        return this.el ? this.el.nativeElement.offsetWidth : 0;\n      }\n    }, {\n      key: \"index\",\n      get: function get() {\n        return this._index;\n      },\n      set: function set(value) {\n        this._index = value;\n        this.toggle();\n      }\n    }, {\n      key: \"menuWidth\",\n      get: function get() {\n        return this.hostWidth - 300;\n      }\n    }, {\n      key: \"nextZIndex\",\n      get: function get() {\n        return Math.max.apply(Math, _toConsumableArray(this.widgets.map(function (x) {\n          return x.zIndex;\n        })).concat([0])) + 1;\n      }\n    }, {\n      key: \"showBack\",\n      get: function get() {\n        return this.index !== 0;\n      }\n    }, {\n      key: \"showNext\",\n      get: function get() {\n        return this.lkpWidgets.length > this.index + this.totalVisible;\n      }\n    }, {\n      key: \"totalAfter\",\n      get: function get() {\n        return this.lkpWidgets.length - (this.index + this.totalVisible);\n      }\n    }, {\n      key: \"totalVisible\",\n      get: function get() {\n        return Math.floor(this.menuWidth / 140);\n      }\n    }, {\n      key: \"widgets\",\n      get: function get() {\n        return this._widgets;\n      },\n      set: function set(value) {\n        this._widgets = value; // this.visibleItems = this.lkpWidgets.filter((x, i) => i >= this.index && i < this.index + this.totalVisible);\n\n        this.toggle();\n      }\n    }, {\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        this.sync(['defaultWidgets', 'lkpWidgets', 'widgets', 'widgetsHeight', 'windowHeight', 'windowWidth', 'userId', 'hasDefaultWidgets']);\n      }\n    }, {\n      key: \"back\",\n      value: function back() {\n        this.index -= this.totalVisible;\n      }\n    }, {\n      key: \"onAdd\",\n      value: function onAdd(e) {\n        var top = this.widgetsHeight + 20;\n        var w;\n\n        switch (e) {\n          case 'meetings':\n            w = build(Widget, {\n              name: 'meetings',\n              userId: this.userId,\n              label: 'Meetings',\n              left: 20,\n              top: top,\n              offsetY: top / this.windowHeight,\n              offsetX: 20 / this.windowWidth,\n              height: 500 / this.windowHeight,\n              width: .9,\n              heightPx: 500,\n              widthPx: .9 * this.windowWidth\n            });\n            break;\n\n          default:\n            w = build(Widget, {\n              name: e,\n              userId: this.userId,\n              offsetX: .25,\n              offsetY: top / this.windowHeight,\n              width: .5,\n              height: .5,\n              zIndex: this.nextZIndex,\n              top: top\n            });\n        }\n\n        if (this.hasDefaultWidgets) {\n          this.saveUserWidgets([].concat(_toConsumableArray(this.widgets), [w]));\n        } else {\n          this.addWidget(w);\n        }\n      }\n    }, {\n      key: \"onFocus\",\n      value: function onFocus(e) {\n        this.updateWidget(build(Widget, this.widgets.find(function (x) {\n          return x.id === e;\n        }), {\n          zIndex: this.nextZIndex\n        }));\n      }\n    }, {\n      key: \"next\",\n      value: function next() {\n        // this.index = this.totalAfter < this.increment ? this.index + this.totalAfter : this.index + this.increment;\n        this.index += this.totalVisible;\n      }\n    }, {\n      key: \"ngAfterViewInit\",\n      value: function ngAfterViewInit() {\n        this.toggle();\n      }\n    }, {\n      key: \"toggle\",\n      value: function toggle() {\n        var _this2 = this;\n\n        this.visibleItems = this.lkpWidgets.filter(function (x, i) {\n          return i >= _this2.index && i < _this2.index + _this2.totalVisible;\n        });\n      }\n    }, {\n      key: \"refresh\",\n      value: function refresh() {}\n    }, {\n      key: \"addWidget\",\n      value: function addWidget(e) {\n        this.dispatch(HttpActions.post(\"widgets\", e, WidgetsActions.POST, WidgetsActions.POST_ERROR));\n        this.index = 0;\n      } // not sure why deleteWidget is used when adding a widget. Adding isActive so the dialog only opens when deleting a widget.\n\n    }, {\n      key: \"deleteWidget\",\n      value: function deleteWidget(e, isActive) {\n        var _this3 = this;\n\n        if (isActive) {\n          var ref = this.dialog.open(ConfirmDeleteComponent, {\n            width: '500px',\n            data: {\n              question: 'Would you like to remove this widget?'\n            }\n          });\n          ref.afterClosed().subscribe(function (result) {\n            if (result) {\n              _this3.dispatch(HttpActions.delete(\"widgets/\".concat(e), e, WidgetsActions.DELETE));\n\n              _this3.index = 0;\n            }\n          });\n        } else {\n          this.dispatch(HttpActions.delete(\"widgets/\".concat(e), e, WidgetsActions.DELETE));\n          this.index = 0;\n        }\n      }\n    }, {\n      key: \"updateWidget\",\n      value: function updateWidget(e) {\n        this.dispatch(HttpActions.put(\"widgets/\".concat(e.id), e, WidgetsActions.PUT));\n      }\n    }, {\n      key: \"restoreDefault\",\n      value: function restoreDefault() {\n        var _this4 = this;\n\n        this.restoringDefaults = true;\n        this.httpPost(\"widgets/user\", this.defaultWidgets, WidgetsActions.RESET, WidgetsActions.RESET_ERROR).subscribe(function (x) {\n          _this4.restoringDefaults = false;\n        });\n        this.index = 0;\n      }\n    }, {\n      key: \"saveUserWidgets\",\n      value: function saveUserWidgets(e) {\n        this.dispatch(HttpActions.post(\"widgets/user\", e, WidgetsActions.POST));\n        this.index = 0;\n      }\n    }]);\n\n    return WidgetsMenuComponent;\n  }(SmartComponent);\n\n  WidgetsMenuComponent.ɵfac = function WidgetsMenuComponent_Factory(t) {\n    return new (t || WidgetsMenuComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i2.MatDialog));\n  };\n\n  WidgetsMenuComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: WidgetsMenuComponent,\n    selectors: [[\"iu-widgets-menu\"]],\n    viewQuery: function WidgetsMenuComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        var _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.widgetsList = _t);\n      }\n    },\n    inputs: {\n      increment: \"increment\",\n      width: \"width\",\n      wrapperHeight: \"wrapperHeight\",\n      visible: \"visible\",\n      userId: \"userId\"\n    },\n    outputs: {\n      add: \"add\",\n      remove: \"remove\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 2,\n    vars: 3,\n    consts: [[\"class\", \"widgets-menu\", 4, \"ngIf\"], [1, \"widgets-menu\"], [\"mat-raised-button\", \"\", \"class\", \"btn-reset\", 3, \"click\", 4, \"ngIf\"], [\"color\", \"accent\", 3, \"diameter\", 4, \"ngIf\"], [1, \"hint\", \"font-effect-emboss\"], [\"mat-fab\", \"\", \"class\", \"arrow\", 3, \"click\", 4, \"ngIf\"], [1, \"widgets-list\"], [\"class\", \"btn-widget font-effect-outline\", \"mat-button\", \"\", \"color\", \"accent\", 3, \"disabled\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"mat-raised-button\", \"\", 1, \"btn-reset\", 3, \"click\"], [\"color\", \"accent\", 3, \"diameter\"], [\"mat-fab\", \"\", 1, \"arrow\", 3, \"click\"], [\"mat-button\", \"\", \"color\", \"accent\", 1, \"btn-widget\", \"font-effect-outline\", 3, \"disabled\", \"click\"], [\"btnWidget\", \"\"], [\"class\", \"btn-add\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"btn-remove\", 3, \"click\", 4, \"ngIf\"], [1, \"btn-add\", 3, \"click\"], [1, \"btn-remove\", 3, \"click\"]],\n    template: function WidgetsMenuComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, WidgetsMenuComponent_div_0_Template, 9, 7, \"div\", 0);\n        i0.ɵɵpipe(1, \"async\");\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.routeName$) === \"dashboard\");\n      }\n    },\n    directives: [i3.NgIf, i4.MatButton, i5.MatIcon, i6.MatProgressSpinner, i3.NgForOf],\n    pipes: [i3.AsyncPipe],\n    styles: [\"[_nghost-%COMP%]{display:block}.widgets-menu[_ngcontent-%COMP%]{width:100%;background:transparent;position:relative;height:51px;display:flex;align-items:center}.widgets-menu[_ngcontent-%COMP%]   .btn-reset[_ngcontent-%COMP%]{color:#fff;min-width:96px}.widgets-menu[_ngcontent-%COMP%]   .btn-reset[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#000}.widgets-menu[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin:0 20px}.widgets-menu[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{padding:0 10px;min-width:90px;max-width:90px}.widgets-menu[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{height:36px;width:36px;display:flex;align-items:center;justify-content:center}.widgets-menu[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:36px;height:36px;width:36px;color:#fff}.widgets-menu[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:hover{color:#fff}.widgets-menu[_ngcontent-%COMP%]   .more[_ngcontent-%COMP%]{font-size:48px;margin:0 20px;height:48px;width:48px}.widgets-menu[_ngcontent-%COMP%]   .widgets-list[_ngcontent-%COMP%]{overflow-x:auto;display:flex;flex-direction:row;align-items:center;justify-content:space-evenly}.widgets-menu[_ngcontent-%COMP%]   .btn-widget[_ngcontent-%COMP%]{margin:5px 0;position:relative;color:#fff;display:flex;align-items:center;justify-content:space-evenly;background:rbga(0,0,0,.7)}.widgets-menu[_ngcontent-%COMP%]   .btn-widget[_ngcontent-%COMP%]   .btn-add[_ngcontent-%COMP%]{cursor:pointer}.widgets-menu[_ngcontent-%COMP%]   .btn-widget[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]{color:red;cursor:pointer}.widgets-menu[_ngcontent-%COMP%]   .btn-widget[_ngcontent-%COMP%]   .btn-remove[_ngcontent-%COMP%]:hover{color:red}\"]\n  });\n  return WidgetsMenuComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}