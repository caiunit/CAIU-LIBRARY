{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\classCallCheck.js\";\nimport _createClass from \"C:\\\\Users\\\\dsalgado.contr\\\\source\\\\Workspaces\\\\CAIU-LIBRARY\\\\CAIU-LIBRARY\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createClass.js\";\nimport { combineLatest } from 'rxjs';\nimport { distinctUntilChanged, map } from 'rxjs/operators';\nimport { LookupValue } from '../lookup/lookup.models';\nimport { lookupValuesSelector } from '../lookup/lookup.selectors';\nimport { arrayDistinct, build, compareNumbers, truthy } from '../shared/utils';\nimport { windowHeightSelector, windowWidthSelector } from '../store/selectors';\nimport { Widget, Widgets } from './widgets.model';\nexport var WidgetsActions = /*#__PURE__*/(function () {\n  var WidgetsActions = /*#__PURE__*/function () {\n    function WidgetsActions() {\n      _classCallCheck(this, WidgetsActions);\n    }\n\n    _createClass(WidgetsActions, null, [{\n      key: \"toggleIcons\",\n      value: function toggleIcons(id, visible) {\n        return {\n          type: visible ? WidgetsActions.SHOW_ICONS : WidgetsActions.HIDE_ICONS,\n          payload: id\n        };\n      }\n    }]);\n\n    return WidgetsActions;\n  }();\n\n  WidgetsActions.DELETE = '[Widgets] DELETE';\n  WidgetsActions.GET = '[Widgets] GET';\n  WidgetsActions.POST = '[Widgets] POST';\n  WidgetsActions.POST_ERROR = '[Widgets] POST ERROR';\n  WidgetsActions.PUT = '[Widgets] PUT';\n  WidgetsActions.RESET = '[Widgets] RESET';\n  WidgetsActions.RESET_ERROR = '[Widgets] RESET ERROR';\n  WidgetsActions.SHOW_ICONS = '[Widgets] SHOW ICONS';\n  WidgetsActions.HIDE_ICONS = '[Widgets] HIDE ICONS';\n  return WidgetsActions;\n})();\nexport function widgetsReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Widgets();\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case WidgetsActions.POST:\n    case WidgetsActions.PUT:\n      return state.update(action.payload);\n\n    case WidgetsActions.GET:\n    case WidgetsActions.RESET:\n      return state.replace(action.payload);\n\n    case WidgetsActions.DELETE:\n      return state.delete(action.payload);\n\n    case WidgetsActions.SHOW_ICONS:\n      return state.showIcons(action.payload);\n\n    case WidgetsActions.HIDE_ICONS:\n      return state.hideIcons(action.payload);\n\n    default:\n      return state;\n  }\n}\nexport function widgetsSelector(store) {\n  return store.select('widgets');\n}\nexport function userWidgetsSelector(store) {\n  return combineLatest([widgetsSelector(store), lookupValuesSelector(store, 'lkpWidgets'), windowHeightSelector(store), windowWidthSelector(store)]).pipe(map(function (z) {\n    var userWidgets = arrayDistinct(z[0].asArray.map(function (x) {\n      return build(Widget, x, {\n        label: build(LookupValue, z[1].find(function (y) {\n          return y.name === x.name;\n        })).label,\n        left: x.offsetX * z[3],\n        top: x.offsetY * z[2],\n        heightPx: x.height === 0 ? 400 : x.height * z[2],\n        widthPx: x.width === 0 ? 500 : x.width * z[3]\n      });\n    }), function (x) {\n      return x.name;\n    });\n    return userWidgets.length > 0 ? userWidgets : z[0].getDefaultItems(z[2], z[3]);\n  }));\n}\nexport function widgetsLookupSelector(store) {\n  return combineLatest([lookupValuesSelector(store, 'lkpWidgets'), userWidgetsSelector(store)]).pipe(map(function (x) {\n    return x[0].map(function (y) {\n      var widget = x[1].find(function (w) {\n        return w.name === y.name;\n      });\n      return build(Widget, widget, {\n        label: y.label,\n        name: y.name,\n        active: truthy(widget)\n      });\n    }).sort(function (a, b) {\n      return compareNumbers(-a.id, -b.id);\n    });\n  }));\n}\nexport function widgetsDefaultSelector(store) {\n  return combineLatest([widgetsSelector(store), windowHeightSelector(store), windowWidthSelector(store)]).pipe(map(function (x) {\n    return x[0].getDefaultItems(x[1], x[2]);\n  }));\n}\nexport function widgetsBorderWidthSelector(store) {\n  return widgetsSelector(store).pipe(map(function (x) {\n    return x.borderWidth;\n  }), distinctUntilChanged());\n}\nexport function widgetsHeightSelector(store) {\n  return combineLatest([userWidgetsSelector(store), widgetsBorderWidthSelector(store)]).pipe(map(function (x) {\n    return x[0].reduce(function (acc, y) {\n      var topPx = y.top + y.heightPx + 2 * x[1];\n      return Math.max(acc, topPx);\n    }, 0);\n  }));\n}\nexport function widgetsWidthSelector(store) {\n  return combineLatest([userWidgetsSelector(store), widgetsBorderWidthSelector(store)]).pipe(map(function (x) {\n    return x[0].reduce(function (acc, y) {\n      var topPx = y.top + y.heightPx + 2 * x[1];\n      return Math.max(acc, topPx);\n    }, 0);\n  }));\n}\nexport function hasDefaultWidgetsSelector(store) {\n  return widgetsSelector(store).pipe(map(function (x) {\n    return x.asArray.length === 0;\n  }));\n}","map":null,"metadata":{},"sourceType":"module"}